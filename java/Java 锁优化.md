# Java 锁优化

## 锁消除

通过逃逸分析，对检测到不可能发生共享数据竞争的锁进行消除。

## 锁粗化

对于频繁的加锁，扩大加锁的范围。

## 自旋锁（自适应自旋）

不阻塞线程，循环等待锁可用，消耗CPU资源。

## 偏向锁

开启该特性时，第一个线程通过CAS获取偏向锁，以后只需检查对象头记录的ThreadId和自身线程id是否一致，若一致即可直接进入同步代码块。另一个线程尝试获取锁后，偏向锁膨胀为轻量级锁。

## 轻量级锁

通过CAS对象头Mark Word获取锁，CAS解锁。加锁存在竞争时（先自旋）膨胀为重量级锁。

## 重量级锁（操作系统级别）

使用互斥量，需转入内核态，阻塞线程。