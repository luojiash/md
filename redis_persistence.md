# Redis持久化

RDB优点：

- RDB是某个时间点的数据库快照文件，适用于做备份。
- RDB适合数据恢复的场景，单一文件方便传输。
- 由子进程执行备份，父进程只需要fork一个子进程，没有任何IO，最大化Redis性能。
- 相比AOF，RDB数据恢复速度更快。

RDB缺点：

- RDB在遇到故障时，会丢失更多数据。
- 如果数据集比较大，或者CPU性能不佳，fork可能会花费比较长的时间。(AOF重写也需要fork，不过重写对数据持久化没有影响，所以可以在请求低峰期重写)

AOF（Append-only file）优点：

- 默认每秒执行一次刷盘（fsync），持久化更可靠。
- AOF日志文件采用追加写，没有磁盘寻址，写入性能高，文件不容易损坏，即使损坏也很容易修复。
- 当日志文件太大时，Redis能在后台重写AOF文件，使文件包含最少数量的操作。
- AOF用易于理解的格式记录每个Redis操作，适合做误删除的紧急恢复。比如不小心用`flushall`命令清空了数据，只要还没发生重写，就可以把AOF文件中的`flushall`命令删除，再通过恢复机制恢复数据。

AOF缺点：

- AOF通常比RDB文件更大。
- 每秒刷盘的配置下，AOF比RDB性能差。禁用刷盘配置下，两者性能相当。

[Redis Persistence – Redis](https://redis.io/topics/persistence)

