# MySQL查询优化

### 延迟关联

MySQL分页会从头读取数据，并丢弃不需要的行，所以越往后的页，查询越慢。可以首先只查出记录ID，再通过ID关联原表，可大大减少读取的数据量。

```
select * from t_user a, (select id from t_user where city = 'SZ' limit 10000,10) b
where a.id = b.id;
```

### 覆盖索引

查询的字段都包含在索引中，只需检索索引就能查得数据。适用于查询字段很少的场景。

### 排序字段索引

将排序字段包含在索引中，可利用索引的有序性避免filesort。例如以下sql可创建`(city, age)`的索引避免文件排序。

```
select * from t_user where city = 'SZ' order by age;
```

### 索引字段顺序

区分度高的字段放在索引前面，查询时可有效减少检索的数据范围。

范围查询的索引字段必须放在末位。

**网上常见的SQL索引优化原则**

1. 全值匹配
2. 最左前缀原则
3. 不在索引列上做任何操作（计算、函数、类型转换），否则会导致索引失效
4. 索引上范围条件右边的列无法被使用
5. 使用覆盖索引
6. `!=`、`<>`无法使用索引
7. `is null`、`is not null`无法使用索引
8. `like`查询值以通配符`%`开头无法使用索引
9. 字符串不加引号（类型转换）无法使用索引
10. `or`可能使索引失效
